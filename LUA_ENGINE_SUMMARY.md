# Luaè¯·æ±‚å’ŒHTMLè§£æå¼•æ“æ€»ç»“

## ğŸ‰ æˆåŠŸå®ç°çš„åŠŸèƒ½

æˆ‘å·²ç»æˆåŠŸä¸ºæ‚¨åˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„åŸºäºLuaçš„è¯·æ±‚å’ŒHTMLè§£æå¼•æ“ï¼Œå°†Goçš„æµè§ˆå™¨è¯·æ±‚å·¥å…·å’Œgoqueryçš„selectèƒ½åŠ›æ³¨å…¥åˆ°Luaä¸­ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
internal/lua/
â”œâ”€â”€ engine.go          # Luaå¼•æ“æ ¸å¿ƒå®ç°
â”œâ”€â”€ README.md          # è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
â””â”€â”€ USAGE.md           # å¿«é€Ÿä½¿ç”¨æŒ‡å—

cmd/lua-demo/
â””â”€â”€ main.go            # Luaæ¼”ç¤ºç¨‹åº

scripts/
â””â”€â”€ example.lua        # Luaè„šæœ¬ç¤ºä¾‹
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. HTTPè¯·æ±‚åŠŸèƒ½
- âœ… `http_get(url)` - GETè¯·æ±‚
- âœ… `http_post(url, data)` - POSTè¯·æ±‚
- âœ… `set_headers(headers)` - è®¾ç½®è¯·æ±‚å¤´
- âœ… `set_cookies(cookies)` - è®¾ç½®Cookie
- âœ… `set_user_agent(user_agent)` - è®¾ç½®User-Agent
- âœ… `set_random_user_agent()` - éšæœºUser-Agent

### 2. HTMLè§£æåŠŸèƒ½
- âœ… `parse_html(html)` - è§£æHTML
- âœ… `select(doc, selector)` - é€‰æ‹©å¤šä¸ªå…ƒç´ 
- âœ… `select_one(doc, selector)` - é€‰æ‹©å•ä¸ªå…ƒç´ 
- âœ… `text(element)` - è·å–æ–‡æœ¬å†…å®¹
- âœ… `html(element)` - è·å–HTMLå†…å®¹
- âœ… `attr(element, name)` - è·å–å±æ€§å€¼

### 3. å·¥å…·å‡½æ•°
- âœ… `print(...)` - æ‰“å°è¾“å‡º
- âœ… `log(...)` - å¸¦æ ‡ç­¾çš„æ—¥å¿—è¾“å‡º

## ğŸ§ª æ¼”ç¤ºç»“æœ

æ¼”ç¤ºç¨‹åºæˆåŠŸè¿è¡Œï¼Œå±•ç¤ºäº†ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **GETè¯·æ±‚**: æˆåŠŸè·å–httpbin.orgçš„å“åº”ï¼ŒçŠ¶æ€ç 200
2. **POSTè¯·æ±‚**: æˆåŠŸå‘é€POSTè¯·æ±‚ï¼ŒçŠ¶æ€ç 502ï¼ˆæ­£å¸¸ï¼Œå› ä¸ºhttpbin.orgçš„POSTç«¯ç‚¹ï¼‰
3. **HTMLè§£æ**: æˆåŠŸè§£æHTMLé¡µé¢ï¼Œæå–äº†H1æ ‡é¢˜å’Œæ®µè½å†…å®¹
4. **å¤æ‚çˆ¬è™«**: æˆåŠŸè·å–User-Agentä¿¡æ¯ï¼Œæ˜¾ç¤ºéšæœºç”Ÿæˆçš„æµè§ˆå™¨æ ‡è¯†

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```go
// åˆ›å»ºæµè§ˆå™¨å’ŒLuaå¼•æ“
browser, _ := crawler.NewDefaultBrowser()
engine := lua.NewLuaEngine(browser)
defer engine.Close()

// æ‰§è¡ŒLuaè„šæœ¬
script := `
    response, err = http_get("https://httpbin.org/get")
    if err then
        print("è¯·æ±‚å¤±è´¥:", err)
    else
        print("çŠ¶æ€ç :", response.status_code)
    end
`
engine.Execute(script)
```

### Luaè„šæœ¬ç¤ºä¾‹
```lua
-- è®¾ç½®éšæœºUser-Agent
set_random_user_agent()

-- å‘é€GETè¯·æ±‚
response, err = http_get("https://example.com")
if err then
    print("è¯·æ±‚å¤±è´¥:", err)
    return
end

-- è§£æHTML
doc, err = parse_html(response.body)
if err then
    print("è§£æå¤±è´¥:", err)
    return
end

-- æå–æ ‡é¢˜
title_element, err = select_one(doc, "h1")
if err then
    print("è·å–æ ‡é¢˜å¤±è´¥:", err)
else
    title = text(title_element)
    print("é¡µé¢æ ‡é¢˜:", title)
end
```

## ğŸ”§ æŠ€æœ¯å®ç°

### ä¾èµ–åº“
- `github.com/yuin/gopher-lua` - Luaå¼•æ“
- `github.com/PuerkitoBio/goquery` - HTMLè§£æ
- `github.com/gocolly/colly/v2` - çˆ¬è™«æ¡†æ¶
- `github.com/EDDYCJY/fake-useragent` - éšæœºUser-Agent

### æ ¸å¿ƒç‰¹æ€§
1. **ç±»å‹è½¬æ¢**: è‡ªåŠ¨å¤„ç†Goå’ŒLuaä¹‹é—´çš„æ•°æ®ç±»å‹è½¬æ¢
2. **é”™è¯¯å¤„ç†**: å®Œæ•´çš„é”™è¯¯ä¼ é€’å’Œå¤„ç†æœºåˆ¶
3. **å†…å­˜ç®¡ç†**: è‡ªåŠ¨ç®¡ç†LuaçŠ¶æ€å’Œèµ„æº
4. **æ€§èƒ½ä¼˜åŒ–**: é«˜æ•ˆçš„HTMLè§£æå’Œé€‰æ‹©å™¨æ‰§è¡Œ

## ğŸ¯ åº”ç”¨åœºæ™¯

è¿™ä¸ªLuaå¼•æ“ç‰¹åˆ«é€‚ç”¨äºï¼š

1. **åŠ¨æ€çˆ¬è™«è„šæœ¬**: å¯ä»¥ç¼–å†™çµæ´»çš„çˆ¬è™«é€»è¾‘
2. **é…ç½®åŒ–çˆ¬å–**: é€šè¿‡Luaè„šæœ¬é…ç½®çˆ¬å–è§„åˆ™
3. **å¿«é€ŸåŸå‹**: å¿«é€Ÿæµ‹è¯•å’ŒéªŒè¯çˆ¬å–é€»è¾‘
4. **æ’ä»¶ç³»ç»Ÿ**: ä½œä¸ºçˆ¬è™«ç³»ç»Ÿçš„è„šæœ¬æ’ä»¶

## ğŸ“ˆ ä¼˜åŠ¿

1. **çµæ´»æ€§**: Luaè„šæœ¬å¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œæ— éœ€é‡æ–°ç¼–è¯‘
2. **æ˜“ç”¨æ€§**: ç®€æ´çš„APIè®¾è®¡ï¼Œæ˜“äºå­¦ä¹ å’Œä½¿ç”¨
3. **åŠŸèƒ½å®Œæ•´**: é›†æˆäº†å®Œæ•´çš„HTTPè¯·æ±‚å’ŒHTMLè§£æèƒ½åŠ›
4. **çœŸå®æµè§ˆå™¨**: æ”¯æŒéšæœºUser-Agentå’ŒçœŸå®æµè§ˆå™¨è¯·æ±‚å¤´
5. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸš€ ä¸‹ä¸€æ­¥

æ‚¨å¯ä»¥åŸºäºè¿™ä¸ªLuaå¼•æ“ï¼š

1. å¼€å‘æ›´å¤æ‚çš„çˆ¬è™«è„šæœ¬
2. é›†æˆåˆ°ç°æœ‰çš„çˆ¬è™«ç³»ç»Ÿä¸­
3. æ·»åŠ æ›´å¤šçš„Luaå‡½æ•°å’ŒåŠŸèƒ½
4. å®ç°è„šæœ¬ç®¡ç†å’Œè°ƒåº¦ç³»ç»Ÿ

è¿™ä¸ªLuaå¼•æ“ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„å·¥å…·ï¼Œå¯ä»¥ç”¨Luaè„šæœ¬è¿›è¡Œç½‘é¡µçˆ¬å–å’Œè§£æï¼Œå¤§å¤§æé«˜äº†çˆ¬è™«å¼€å‘çš„æ•ˆç‡å’Œçµæ´»æ€§ï¼
